<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student CRM &mdash; Karma &amp; Jasmine Testing Guide</title>
  <style>
    :root {
      color-scheme: light;
      font-family: "Segoe UI", sans-serif;
      line-height: 1.5;
    }
    body {
      margin: 40px;
      color: #222;
    }
    h1 {
      font-size: 26px;
      margin-bottom: 16px;
    }
    h2 {
      font-size: 20px;
      margin-top: 28px;
      margin-bottom: 12px;
    }
    h3 {
      font-size: 16px;
      margin-top: 20px;
      margin-bottom: 8px;
    }
    pre {
      background: #f7f7f7;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 12px;
      font-size: 13px;
      overflow-x: auto;
    }
    code {
      font-family: Consolas, "Courier New", monospace;
    }
    ol {
      padding-left: 22px;
    }
    ul {
      padding-left: 20px;
    }
    li {
      margin-bottom: 8px;
    }
    .note {
      padding: 12px 16px;
      border-left: 4px solid #0078d4;
      background: #eef6fd;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <h1>Student CRM &mdash; Step-by-Step Testing with Karma &amp; Jasmine</h1>
  <p>
    This guide walks students through configuring, writing, and running unit tests for the Student CRM project
    using Angular&#8217;s default Karma runner and Jasmine test framework.
  </p>

  <div class="note">
    <strong>Prerequisites:</strong> Completed Student CRM project, Node 18+, Angular CLI 20, Google Chrome installed (Karma default launcher).
  </div>

  <h2>1. Verify test tooling</h2>
  <ol>
    <li>Open <code>angular.json</code> and confirm the <code>test</code> target uses <code>@angular-devkit/build-angular:karma</code>.</li>
    <li>Check <code>karma.conf.js</code> for the Chrome launcher and Jasmine framework (these are scaffolded by the CLI).</li>
    <li>Ensure <code>src/polyfills.ts</code> is unchanged; tests rely on the same polyfills as the app.</li>
  </ol>

  <h2>2. Smoke-test the runner</h2>
  <ol>
    <li>Install dependencies if needed: <code>npm install</code>.</li>
    <li>Run Karma once in watch mode: <code>npm test</code> or <code>ng test</code>.</li>
    <li>Wait for Chrome to start and the CLI to report <em>0 failed</em>. You should see the default specs generated by the CLI (AppComponent, etc.).</li>
    <li>Stop the watch run with <code>Ctrl + C</code>.</li>
  </ol>

  <h2>3. Organize testing strategy</h2>
  <p>Create a simple checklist for coverage:</p>
  <ul>
    <li><strong>Services:</strong> StudentService (adds, toggles, list copy) and LoggerService (logs).</li>
    <li><strong>Components:</strong> AddStudentComponent (emits form data), StudentListComponent (passes events), StudentCardComponent (emits toggle), HomeComponent (integrates StudentService).</li>
    <li><strong>Pipes/Utilities:</strong> none in this project.</li>
  </ul>

  <h2>4. Write StudentService tests</h2>
  <ol>
    <li>Create <code>src/app/core/student.service.spec.ts</code> (or edit the generated file if it already exists) with:</li>
  </ol>
  <pre><code>import { StudentService } from './student.service';

describe('StudentService', () => {
  let service: StudentService;

  beforeEach(() => {
    service = new StudentService();
  });

  it('should list initial students', () => {
    expect(service.list().length).toBe(2);
  });

  it('should add a student with incremental id', () => {
    const result = service.add({ name: 'Charlie', track: 'DevOps', active: true });
    const added = result.find(s =&gt; s.name === 'Charlie');
    expect(added?.id).toBeGreaterThan(2);
    expect(added?.active).toBeTrue();
  });

  it('should toggle active status immutably', () => {
    const [first] = service.list();
    const toggled = service.toggleActive(first.id);
    const updated = toggled.find(s =&gt; s.id === first.id);
    expect(updated?.active).toBe(!first.active);
    // ensure a new array was returned
    expect(toggled).not.toBe(service['store']);
  });
});</code></pre>

  <h2>5. Test LoggerService</h2>
  <ol>
    <li>In <code>src/app/core/logger.service.spec.ts</code> replace contents with a spy-based check:</li>
  </ol>
  <pre><code>import { LoggerService } from './logger.service';

describe('LoggerService', () => {
  it('should log to console with prefix', () => {
    const svc = new LoggerService();
    spyOn(console, 'log');

    svc.log('Hello');

    expect(console.log).toHaveBeenCalledWith('[LOG] Hello');
  });
});</code></pre>

  <h2>6. Component tests &mdash; AddStudentComponent</h2>
  <ol>
    <li>Edit <code>src/app/students/add-student/add-student.component.spec.ts</code>:</li>
  </ol>
  <pre><code>import { ComponentFixture, TestBed } from '@angular/core/testing';
import { FormsModule } from '@angular/forms';
import { AddStudentComponent } from './add-student';

describe('AddStudentComponent', () => {
  let component: AddStudentComponent;
  let fixture: ComponentFixture&lt;AddStudentComponent&gt;;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [FormsModule, AddStudentComponent]
    }).compileComponents();

    fixture = TestBed.createComponent(AddStudentComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should emit create event on submit', () => {
    spyOn(component.create, 'emit');
    component.name = 'Dana';
    component.track = 'Data';
    component.active = false;

    component.submit();

    expect(component.create.emit).toHaveBeenCalledWith({
      name: 'Dana',
      track: 'Data',
      active: false
    });
    expect(component.name).toBe('');
    expect(component.active).toBeTrue();
  });

  it('should ignore blank names', () => {
    spyOn(component.create, 'emit');
    component.name = '   ';
    component.submit();
    expect(component.create.emit).not.toHaveBeenCalled();
  });
});</code></pre>

  <h2>7. Component tests &mdash; StudentCardComponent</h2>
  <ol>
    <li>Update <code>src/app/students/student-card/student-card.component.spec.ts</code>:</li>
  </ol>
  <pre><code>import { ComponentFixture, TestBed } from '@angular/core/testing';
import { StudentCardComponent } from './student-card';
import { Student } from '../../core/student';

describe('StudentCardComponent', () => {
  let component: StudentCardComponent;
  let fixture: ComponentFixture&lt;StudentCardComponent&gt;;

  const mockStudent: Student = {
    id: 42,
    name: 'Eve',
    track: 'Front-end',
    active: true
  };

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [StudentCardComponent]
    }).compileComponents();

    fixture = TestBed.createComponent(StudentCardComponent);
    component = fixture.componentInstance;
    component.student = mockStudent;
    fixture.detectChanges();
  });

  it('should render the student name', () => {
    const nameEl: HTMLElement = fixture.nativeElement.querySelector('.title');
    expect(nameEl?.textContent).toContain('Eve');
  });

  it('should emit toggle event with id', () => {
    spyOn(component.toggle, 'emit');
    const button: HTMLButtonElement = fixture.nativeElement.querySelector('button');
    button.click();
    expect(component.toggle.emit).toHaveBeenCalledWith(42);
  });
});</code></pre>

  <h2>8. Component tests &mdash; StudentListComponent</h2>
  <ol>
    <li>Edit <code>src/app/students/student-list/student-list.component.spec.ts</code> to check bindings:</li>
  </ol>
  <pre><code>import { ComponentFixture, TestBed } from '@angular/core/testing';
import { StudentListComponent } from './student-list';
import { StudentCardComponent } from '../student-card/student-card';
import { Student } from '../../core/student';
import { Component } from '@angular/core';

@Component({
  template: `
    &lt;app-student-list
      [students]="students"
      (toggleActive)="onToggle($event)"&gt;
    &lt;/app-student-list&gt;
  `
})
class HostComponent {
  students: Student[] = [
    { id: 1, name: 'Alice', track: 'Front-end', active: true },
    { id: 2, name: 'Bob', track: 'Data', active: false }
  ];
  lastToggle?: number;
  onToggle(id: number) { this.lastToggle = id; }
}

describe('StudentListComponent', () => {
  let fixture: ComponentFixture&lt;HostComponent&gt;;
  let host: HostComponent;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [HostComponent],
      imports: [StudentListComponent, StudentCardComponent]
    }).compileComponents();

    fixture = TestBed.createComponent(HostComponent);
    host = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should render a card for each student', () => {
    const cards = fixture.nativeElement.querySelectorAll('app-student-card');
    expect(cards.length).toBe(2);
  });

  it('should bubble toggle events', () => {
    const cardDebug = fixture.debugElement.queryAllNodes(n =&gt; n.name === 'app-student-card')[0];
    cardDebug.triggerEventHandler('toggle', 1);
    expect(host.lastToggle).toBe(1);
  });
});</code></pre>

  <h2>9. Component tests &mdash; HomeComponent</h2>
  <ol>
    <li>Replace <code>src/app/home/home.component.spec.ts</code> with an integration-style spec:</li>
  </ol>
  <pre><code>import { ComponentFixture, TestBed } from '@angular/core/testing';
import { HomeComponent } from './home';
import { StudentsModule } from '../students/students-module';
import { StudentService } from '../core/student';

describe('HomeComponent', () => {
  let fixture: ComponentFixture&lt;HomeComponent&gt;;
  let component: HomeComponent;
  let service: StudentService;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [StudentsModule],
      declarations: [HomeComponent]
    }).compileComponents();

    fixture = TestBed.createComponent(HomeComponent);
    component = fixture.componentInstance;
    service = TestBed.inject(StudentService);
    fixture.detectChanges();
  });

  it('should load students on init', () => {
    expect(component.students.length).toBeGreaterThan(0);
  });

  it('should add a new student via child event', () => {
    component.onCreate({ name: 'Frank', track: 'DevOps', active: true });
    expect(component.students.some(s =&gt; s.name === 'Frank')).toBeTrue();
  });

  it('should toggle student active state', () => {
    const [first] = service.list();
    component.onToggleActive(first.id);
    const updated = component.students.find(s =&gt; s.id === first.id);
    expect(updated?.active).toBe(!first.active);
  });
});</code></pre>

  <h2>10. Run the suite in watch &amp; CI modes</h2>
  <ol>
    <li>Start watch mode during development: <code>ng test</code>.</li>
    <li>For CI, run headless Chrome: <code>ng test --watch=false --browsers=ChromeHeadless</code>.</li>
    <li>Ensure all specs pass (expect &ldquo;Executed X of X SUCCESS&rdquo;).</li>
  </ol>

  <h2>11. Common troubleshooting tips</h2>
  <ul>
    <li>If TestBed cannot resolve a component, confirm the component is imported (standalone) or declared in the testing module.</li>
    <li>For template parse errors, add required Angular modules (<code>FormsModule</code>, etc.) to <code>imports</code>.</li>
    <li>Use <code>fixture.detectChanges()</code> after updating component inputs or calling methods that affect bindings.</li>
    <li>Mock service dependencies with spies or simple classes and provide them via <code>providers</code>.</li>
  </ul>

  <p>
    Following these steps gives the class a complete, green unit-test suite for the Student CRM application, demonstrating both service testing and component interaction patterns with Karma and Jasmine.
  </p>
</body>
</html>
